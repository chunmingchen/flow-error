
true_list = '/data/flow/isabel_all/2d/all8.list';
fitted_list = '/data/flow/isabel_all/2d/fitted_quad_endpoint8/all8.list';
stderr_file = '/data/flow/isabel_all/2d/fitted_quad_endpoint8/sampling8_00_stderr.raw';
global data_w data_d data_t data_h 

fitted_list = load_list(fitted_list);

data_t = 9; % sampling+1
t_ary = 0:0.25:data_t-1.25; t_ary = t_ary';

true_raw_ary=[213.000000 321.000000 2.000000 0.000000; 218.264999 335.615631 2.000000 1.000000; 219.590836 339.345367 2.000000 1.250000; 220.884552 343.143188 2.000000 1.500000; 222.179016 347.090820 2.000000 1.750000; 223.544556 351.243347 2.000000 2.000000; 225.029282 355.561768 2.000000 2.250000; 226.612366 360.029541 2.000000 2.500000; 228.304749 364.717285 2.000000 2.750000; 230.107864 369.646118 2.000000 3.000000; 232.038223 374.696167 2.000000 3.250000; 234.135590 379.817291 2.000000 3.500000; 236.424286 385.069733 2.000000 3.750000; 238.855499 390.447113 2.000000 4.000000; 241.412338 395.912598 2.000000 4.250000; 244.122879 401.403473 2.000000 4.500000; 247.027832 406.942108 2.000000 4.750000; 250.100861 412.518341 2.000000 5.000000; 253.303619 418.134766 2.000000 5.250000; 256.689392 423.832092 2.000000 5.500000; 260.282410 429.605438 2.000000 5.750000; 264.066742 435.430450 2.000000 6.000000; 268.018890 441.254059 2.000000 6.250000; 272.206024 447.058197 2.000000 6.500000; 276.646057 452.870605 2.000000 6.750000; 281.233856 458.664673 2.000000 7.000000; 285.978577 464.402161 2.000000 7.250000; 290.917542 470.061523 2.000000 7.500000; 296.079987 475.734955 2.000000 7.750000; 301.366943 481.484558 2.000000 8.000000];

uneven_t_ary = true_raw_ary(:,4);
true_x_ary = [interp1q(uneven_t_ary, true_raw_ary(:,1), t_ary) ...
              interp1q(uneven_t_ary, true_raw_ary(:,2), t_ary)];
true_x_ary = true_x_ary';

% fit
[errstd1, errsum1, yy1, a, b, c] = quadfit_endpoint(t_ary,true_x_ary(1,:)',t_ary);
[errstd2, errsum2, yy2, a, b, c] = quadfit_endpoint(t_ary,true_x_ary(2,:)',t_ary);

z_ary = [yy1 yy2];
z_ary=z_ary';
z_stderr = [errstd1+errsum1; errstd2+errsum2]*5;
% z_stderr = [errstd1;errstd2]*.5;

traced_fitted_x_raw_ary=[213.000000 321.000000 2.000000 0.000000; 217.474640 333.771393 2.000000 0.839386; 218.886032 337.838318 2.000000 1.089386; 220.342026 342.015961 2.000000 1.339386; 221.825226 346.269806 2.000000 1.589386; 223.328873 350.600830 2.000000 1.839386; 224.909058 355.000824 2.000000 2.089386; 226.625381 359.475677 2.000000 2.339386; 228.478973 364.047424 2.000000 2.589386; 230.399445 368.679962 2.000000 2.839386; 232.363113 373.374329 2.000000 3.089386; 234.410721 378.156342 2.000000 3.339386; 236.578445 383.067963 2.000000 3.589386; 238.878967 388.103455 2.000000 3.839386; 241.281891 393.224243 2.000000 4.089386; 243.853271 398.432068 2.000000 4.339386; 246.630112 403.745667 2.000000 4.589386; 249.585327 409.113739 2.000000 4.839386; 252.692947 414.487762 2.000000 5.089386; 255.958649 419.833069 2.000000 5.339386; 259.371796 425.171692 2.000000 5.589386; 262.913666 430.503113 2.000000 5.839386; 266.577515 435.810242 2.000000 6.089386; 270.371490 441.078552 2.000000 6.339386; 274.308136 446.335052 2.000000 6.589386; 278.429077 451.623566 2.000000 6.839386; 282.778534 456.992310 2.000000 7.089386; 287.314575 462.406860 2.000000 7.339386; 291.994690 467.854797 2.000000 7.589386; 296.915680 473.418365 2.000000 7.839386];
traced_fitted_x_ary = [interp1q(traced_fitted_x_raw_ary(:,4), traced_fitted_x_raw_ary(:,1), t_ary) ...
                       interp1q(traced_fitted_x_raw_ary(:,4), traced_fitted_x_raw_ary(:,2), t_ary)];
traced_fitted_x_ary=traced_fitted_x_ary'; 

trace_filtering


% 
% true_list = '/data/flow/isabel_all/2d/all8.list';
% fitted_list = '/data/flow/isabel_all/2d/fitted_quad_endpoint/all8.list';
% stderr_file = '/data/flow/isabel_all/2d/fitted_quad_endpoint/sampling8_00_stderr.raw';
% global data_w data_d data_t data_h 
% 
% fitted_list = load_list(fitted_list);
% 
% data_t = 9; % sampling+1
% 
% true_raw_ary=[213.000000 321.000000 2.000000 0.000000; 218.264999 335.615631 2.000000 1.000000; 219.590836 339.345367 2.000000 1.250000; 220.884552 343.143188 2.000000 1.500000; 222.179016 347.090820 2.000000 1.750000; 223.544556 351.243347 2.000000 2.000000; 225.029282 355.561768 2.000000 2.250000; 226.612366 360.029541 2.000000 2.500000; 228.304749 364.717285 2.000000 2.750000; 230.107864 369.646118 2.000000 3.000000; 232.038223 374.696167 2.000000 3.250000; 234.135590 379.817291 2.000000 3.500000; 236.424286 385.069733 2.000000 3.750000; 238.855499 390.447113 2.000000 4.000000; 241.412338 395.912598 2.000000 4.250000; 244.122879 401.403473 2.000000 4.500000; 247.027832 406.942108 2.000000 4.750000; 250.100861 412.518341 2.000000 5.000000; 253.303619 418.134766 2.000000 5.250000; 256.689392 423.832092 2.000000 5.500000; 260.282410 429.605438 2.000000 5.750000; 264.066742 435.430450 2.000000 6.000000; 268.018890 441.254059 2.000000 6.250000; 272.206024 447.058197 2.000000 6.500000; 276.646057 452.870605 2.000000 6.750000; 281.233856 458.664673 2.000000 7.000000; 285.978577 464.402161 2.000000 7.250000; 290.917542 470.061523 2.000000 7.500000; 296.079987 475.734955 2.000000 7.750000; 301.366943 481.484558 2.000000 8.000000];
% 
% t_ary = true_raw_ary(:,4);
% true_x_ary = [true_raw_ary(:,1) true_raw_ary(:,2)];
% true_x_ary = true_x_ary';
% 
% % fit
% [err1, a, b, c, yy1] = quadfit_endpoint(t_ary,true_raw_ary(:,1),t_ary);
% [err2, a, b, c, yy2] = quadfit_endpoint(t_ary,true_raw_ary(:,2),t_ary);
% 
% z_ary = [yy1 yy2];
% z_ary=z_ary';
% z_stderr = [err1; err2];
% 
% traced_fitted_x_ary=[213.000000 321.000000 2.000000 0.000000; 217.474640 333.771393 2.000000 0.839386; 218.886032 337.838318 2.000000 1.089386; 220.342026 342.015961 2.000000 1.339386; 221.825226 346.269806 2.000000 1.589386; 223.328873 350.600830 2.000000 1.839386; 224.909058 355.000824 2.000000 2.089386; 226.625381 359.475677 2.000000 2.339386; 228.478973 364.047424 2.000000 2.589386; 230.399445 368.679962 2.000000 2.839386; 232.363113 373.374329 2.000000 3.089386; 234.410721 378.156342 2.000000 3.339386; 236.578445 383.067963 2.000000 3.589386; 238.878967 388.103455 2.000000 3.839386; 241.281891 393.224243 2.000000 4.089386; 243.853271 398.432068 2.000000 4.339386; 246.630112 403.745667 2.000000 4.589386; 249.585327 409.113739 2.000000 4.839386; 252.692947 414.487762 2.000000 5.089386; 255.958649 419.833069 2.000000 5.339386; 259.371796 425.171692 2.000000 5.589386; 262.913666 430.503113 2.000000 5.839386; 266.577515 435.810242 2.000000 6.089386; 270.371490 441.078552 2.000000 6.339386; 274.308136 446.335052 2.000000 6.589386; 278.429077 451.623566 2.000000 6.839386; 282.778534 456.992310 2.000000 7.089386; 287.314575 462.406860 2.000000 7.339386; 291.994690 467.854797 2.000000 7.589386; 296.915680 473.418365 2.000000 7.839386];
% traced_fitted_x_ary=traced_fitted_x_ary'; 
% 
% trace_filtering
% 
% 
% 
